# 2.8. cogs/youtube_tracker.py (íŒŒì´ì¬ ë´‡ìš©)
def get_youtube_tracker_py_content(bot_name):
    return f"""
import discord
from discord.ext import commands, tasks
import json
import datetime
from googleapiclient.discovery import build # ğŸš© build ì„í¬íŠ¸
import asyncio

class YouTubeTracker(commands.Cog):
    def __init__(self, bot):
        self.bot = bot
        self.get_server_config = bot.get_server_config
        self.youtube_service = bot.youtube_service # bot.pyì—ì„œ ì£¼ì…ëœ YouTube ì„œë¹„ìŠ¤ ê°ì²´

        # ğŸš© YouTube API í‚¤ê°€ ì—†ìœ¼ë©´ ê¸°ëŠ¥ ë¹„í™œì„±í™”
        if not self.youtube_service:
            print("âš ï¸ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. YouTubeTracker ê¸°ëŠ¥ì„ ë¹„í™œì„±í™”í•©ë‹ˆë‹¤.")
            return

        self.last_checked = {{}} # {{guild_id: {{channel_id: last_video_publish_time}}}}
        self.check_youtube_channels.start()

    def cog_unload(self):
        \"\"\"ì½”ê·¸ ì–¸ë¡œë“œ ì‹œ ì‘ì—… ì¤‘ì§€.\"\"\"
        self.check_youtube_channels.cancel()

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
                    response = request.execute()

                    # ì—…ë¡œë“œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
                    uploads_playlist_id = response['items'][0]['contentDetails']['relatedPlaylists']['uploads']

                    playlist_request = self.youtube_service.playlistItems().list(
                        part="snippet",
                        playlistId=uploads_playlist_id,
                        maxResults=1 # ìµœì‹  ë¹„ë””ì˜¤ 1ê°œë§Œ ê°€ì ¸ì˜´
                    )
                    playlist_response = playlist_request.execute()

                    if not playlist_response['items']:
                        continue # ë¹„ë””ì˜¤ê°€ ì—†ëŠ” ì±„ë„

                    latest_video = playlist_response['items'][0]['snippet']
                    video_id = latest_video['resourceId']['videoId']
                    video_title = latest_video['title']
                    publish_time_str = latest_video['publishedAt']

                    # ISO 8601 ë¬¸ìì—´ì„ datetime ê°ì²´ë¡œ ë³€í™˜
                    publish_time = datetime.datetime.fromisoformat(publish_time_str.replace('Z', '+00:00'))

                    # ğŸš© ì´ ì±„ë„(yt_channel_id)ì˜ ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ê°€ì ¸ì˜¤ê¸°
                    last_published = self.last_checked.get(guild_id, {{}}).get(yt_channel_id)

                    if last_published and publish_time <= last_published:
                        continue # ì´ë¯¸ ì•Œë¦¼ ë³´ëƒˆê±°ë‚˜ ë” ì˜¤ë˜ëœ ë¹„ë””ì˜¤

                    # ìƒˆ ë¹„ë””ì˜¤ ê°ì§€: ì•Œë¦¼ ë³´ë‚´ê¸°
                    video_url = f"https://www.youtube.com/watch?v={{video_id}}"
                    channel_title = latest_video['channelTitle']

                    embed = discord.Embed(
                        title=f"ğŸ¬ ìƒˆë¡œìš´ ì˜ìƒ ì—…ë¡œë“œ!",
                        description=f"[{video_title}]({{video_url}})",
                        color=discord.Color.red()
                    )
                    embed.set_author(name=channel_title, url=f"https://www.youtube.com/channel/{{yt_channel_id}}")
                    embed.set_thumbnail(url=latest_video['thumbnails']['high']['url'])
                    embed.set_footer(text=f"ì—…ë¡œë“œë¨: {publish_time.strftime('%Yë…„ %mì›” %dì¼ %Hì‹œ %Më¶„')}")

                    await notification_channel.send(embed=embed)
                    print(f"âœ… ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ - {{video_title}}")

                    # ğŸš© ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
                    if guild_id not in self.last_checked:
                        self.last_checked[guild_id] = {{}}
                    self.last_checked[guild_id][yt_channel_id] = publish_time

                except Exception as e:
                    print(f"âŒ ì„œë²„ {{guild_id}}, ìœ íŠœë¸Œ ì±„ë„ {{yt_channel_id}} í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {{e}}")

    @tasks.loop(minutes=10) # ğŸš© 10ë¶„ë§ˆë‹¤ ìœ íŠœë¸Œ ì±„ë„ í™•ì¸ (API í˜¸ì¶œ ì œí•œ ê³ ë ¤)
    async def check_youtube_channels(self):
        await self.bot.wait_until_ready() # ë´‡ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°

        # ğŸš© server_configs í…Œì´ë¸”ì—ì„œ ìœ íŠœë¸Œ í™œë™ì´ í™œì„±í™”ëœ ëª¨ë“  ì„œë²„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (SQLite ì‚¬ìš©)
        conn = self.bot.get_db_connection()
        cursor = conn.cursor()
        cursor.execute("SELECT guild_id, youtube_activity_enabled, youtube_channel_ids_json, youtube_notification_channel_id FROM server_configs WHERE youtube_activity_enabled = 1")
        active_youtube_configs = cursor.fetchall()
        conn.close()

        if not self.youtube_service:
            print("âŒ YouTube Data API ì„œë¹„ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ í™œë™ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            return

        for config in active_youtube_configs:
            guild_id = config['guild_id']
            youtube_channel_ids = json.loads(config['youtube_channel_ids_json'])
            notification_channel_id = config['youtube_notification_channel_id']

            if not notification_channel_id:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ìœ íŠœë¸Œ ì•Œë¦¼ ì±„ë„ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
                continue

            notification_channel = self.bot.get_channel(int(notification_channel_id))
            if not notification_channel:
                print(f"âš ï¸ ì„œë²„ {{guild_id}}: ì•Œë¦¼ ì±„ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ID: {{notification_channel_id}})")
                continue

            for yt_channel_id in youtube_channel_ids:
                try:
                    # ì±„ë„ì˜ ìµœì‹  ë¹„ë””ì˜¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    request = self.youtube_service.channels().list(
                        part="contentDetails",
                        id=yt_channel_id
                    )
            
